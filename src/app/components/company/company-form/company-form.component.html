<div class="page-header">
  <h1 class="page-title">
    {{ isEditMode ? 'Edit Company' : 'New Company' }}
  </h1>
</div>

<div class="success-message" *ngIf="successMessage">
  {{ successMessage }}
</div>

<div class="card">
  <div class="form-container">
    <form [formGroup]="companyForm" (ngSubmit)="onSubmit()">
      
      <!-- Company Basic Info -->
      <div class="section-header">
        üè¢ Company Basic Info
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label class="form-label required">Company Name</label>
          <input
            type="text"
            formControlName="companyName"
            class="form-input"
            [class.error]="hasError('companyName')"
            placeholder="Enter company name"
          />
          <div class="form-error" *ngIf="hasError('companyName')">
            {{ getErrorMessage('companyName') }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label required">Email</label>
          <input
            type="email"
            formControlName="email"
            class="form-input"
            [class.error]="hasError('email')"
            placeholder="Enter email address"
          />
          <div class="form-error" *ngIf="hasError('email')">
            {{ getErrorMessage('email') }}
          </div>
        </div>
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label class="form-label required">Phone Number</label>
          <input
            type="tel"
            formControlName="phoneNumber"
            class="form-input"
            [class.error]="hasError('phoneNumber')"
            placeholder="Enter phone number"
          />
          <div class="form-error" *ngIf="hasError('phoneNumber')">
            {{ getErrorMessage('phoneNumber') }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Company Address</label>
          <input
            type="text"
            formControlName="address"
            class="form-input"
            placeholder="Enter company address"
          />
        </div>
      </div>

      <!-- Employee Info -->
      <div formArrayName="empInfo">
        <div 
          *ngFor="let empForm of empInfoArray.controls; let empIndex = index"
          [formGroupName]="empIndex"
          class="employee-section"
        >
          <div class="section-header employee-header">
            üë§ Employee Info #{{ empIndex + 1 }}
            <button
              type="button"
              *ngIf="empInfoArray.length > 1"
              (click)="removeEmployee(empIndex)"
              class="btn btn-danger btn-sm remove-btn"
            >
              Remove Employee
            </button>
          </div>

          <!-- Employee Basic Info -->
          <div class="grid-3">
            <div class="form-group">
              <label class="form-label required">Employee Name</label>
              <input
                type="text"
                formControlName="empName"
                class="form-input"
                [class.error]="hasError('empName', empIndex)"
                placeholder="Enter employee name"
              />
              <div class="form-error" *ngIf="hasError('empName', empIndex)">
                {{ getErrorMessage('empName', empIndex) }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">Designation</label>
              <select
                formControlName="designation"
                class="form-input"
                [class.error]="hasError('designation', empIndex)"
              >
                <option value="">Select designation</option>
                <option *ngFor="let des of designations" [value]="des.value">
                  {{ des.label }}
                </option>
              </select>
              <div class="form-error" *ngIf="hasError('designation', empIndex)">
                {{ getErrorMessage('designation', empIndex) }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">Join Date</label>
              <input
                type="date"
                formControlName="joinDate"
                class="form-input"
                [class.error]="hasError('joinDate', empIndex)"
              />
              <div class="form-error" *ngIf="hasError('joinDate', empIndex)">
                {{ getErrorMessage('joinDate', empIndex) }}
              </div>
            </div>
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label class="form-label required">Email</label>
              <input
                type="email"
                formControlName="email"
                class="form-input"
                [class.error]="hasError('email', empIndex)"
                placeholder="Enter employee email"
              />
              <div class="form-error" *ngIf="hasError('email', empIndex)">
                {{ getErrorMessage('email', empIndex) }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">Phone Number</label>
              <input
                type="tel"
                formControlName="phoneNumber"
                class="form-input"
                [class.error]="hasError('phoneNumber', empIndex)"
                placeholder="Enter phone number"
              />
              <div class="form-error" *ngIf="hasError('phoneNumber', empIndex)">
                {{ getErrorMessage('phoneNumber', empIndex) }}
              </div>
            </div>
          </div>

          <!-- Skills Section -->
          <div class="subsection">
            <div class="subsection-header">
              <h4>üõ†Ô∏è Skills Information</h4>
              <button
                type="button"
                (click)="addSkill(empIndex)"
                class="btn btn-secondary btn-sm"
              >
                Add Skill
              </button>
            </div>

            <div formArrayName="skillInfo">
              <div
                *ngFor="let skillForm of getSkillInfoArray(empIndex).controls; let skillIndex = index"
                [formGroupName]="skillIndex"
                class="skill-item"
              >
                <div class="grid-2">
                  <div class="form-group">
                    <label class="form-label required">Skill Name</label>
                    <app-virtual-scroll-select
                      formControlName="skillName"
                      [options]="skills"
                      placeholder="Select skill"
                    ></app-virtual-scroll-select>
                    <div class="form-error" *ngIf="hasError('skillName', empIndex, 'skill', skillIndex)">
                      {{ getErrorMessage('skillName', empIndex, 'skill', skillIndex) }}
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label required">Rating (1-5)</label>
                    <div class="rating-input-group">
                      <input
                        type="number"
                        formControlName="skillRating"
                        class="form-input"
                        [class.error]="hasError('skillRating', empIndex, 'skill', skillIndex)"
                        min="1"
                        max="5"
                        placeholder="1-5"
                      />
                      <button
                        type="button"
                        *ngIf="getSkillInfoArray(empIndex).length > 1"
                        (click)="removeSkill(empIndex, skillIndex)"
                        class="btn btn-danger btn-sm"
                      >
                        Remove
                      </button>
                    </div>
                    <div class="form-error" *ngIf="hasError('skillRating', empIndex, 'skill', skillIndex)">
                      {{ getErrorMessage('skillRating', empIndex, 'skill', skillIndex) }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Education Section -->
          <div class="subsection">
            <div class="subsection-header">
              <h4>üéì Education Information</h4>
              <button
                type="button"
                (click)="addEducation(empIndex)"
                class="btn btn-secondary btn-sm"
              >
                Add Education
              </button>
            </div>

            <div formArrayName="educationInfo">
              <div
                *ngFor="let eduForm of getEducationInfoArray(empIndex).controls; let eduIndex = index"
                [formGroupName]="eduIndex"
                class="education-item"
              >
                <div class="grid-3">
                  <div class="form-group">
                    <label class="form-label required">Institution Name</label>
                    <input
                      type="text"
                      formControlName="instituteName"
                      class="form-input"
                      [class.error]="hasError('instituteName', empIndex, 'education', eduIndex)"
                      placeholder="Enter institution name"
                    />
                    <div class="form-error" *ngIf="hasError('instituteName', empIndex, 'education', eduIndex)">
                      {{ getErrorMessage('instituteName', empIndex, 'education', eduIndex) }}
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label required">Course Name</label>
                    <input
                      type="text"
                      formControlName="courseName"
                      class="form-input"
                      [class.error]="hasError('courseName', empIndex, 'education', eduIndex)"
                      placeholder="Enter course name"
                    />
                    <div class="form-error" *ngIf="hasError('courseName', empIndex, 'education', eduIndex)">
                      {{ getErrorMessage('courseName', empIndex, 'education', eduIndex) }}
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label required">Completed Year</label>
                    <div class="completed-year-group">
                      <input
                        type="text"
                        formControlName="completedYear"
                        class="form-input"
                        [class.error]="hasError('completedYear', empIndex, 'education', eduIndex)"
                        placeholder="Mar 2021"
                      />
                      <button
                        type="button"
                        *ngIf="getEducationInfoArray(empIndex).length > 1"
                        (click)="removeEducation(empIndex, eduIndex)"
                        class="btn btn-danger btn-sm"
                      >
                        Remove
                      </button>
                    </div>
                    <div class="form-error" *ngIf="hasError('completedYear', empIndex, 'education', eduIndex)">
                      {{ getErrorMessage('completedYear', empIndex, 'education', eduIndex) }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" (click)="addEmployee()" class="btn btn-secondary">
          Add Another Employee
        </button>
        
        <div class="action-buttons">
          <button type="button" routerLink="/companies" class="btn btn-secondary">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!companyForm.valid">
            {{ isEditMode ? 'Update Company' : 'Save Company' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
